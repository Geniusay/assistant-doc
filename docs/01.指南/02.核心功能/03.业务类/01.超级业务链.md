---
title: è¶…çº§ä¸šåŠ¡é“¾
date: 2024-06-21 01:37:45
permalink: /pages/f1a3f0/
---

<<< @/docs/.vuepress/Version.md

# è¶…çº§ä¸šåŠ¡é“¾

::: tip ç®€è¿°
å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼šé•¿ä¸”å†—ä½™çš„ä¸šåŠ¡é“¾ï¼Œif-elseé“¾ï¼Œå¾€å¾€è®©æˆ‘ä»¬åœ¨ç¼–å†™ï¼Œç†è§£ï¼Œç»´æŠ¤ï¼Œä¿®æ”¹çš„æ—¶å€™é™·å…¥å¤´ç–¼ï¼Œä¸€äº›é«˜åº¦é‡å¤çš„ä¸šåŠ¡æµç¨‹éš¾ä»¥è¢«å¤ç”¨ï¼Œå¯¼è‡´è®¸å¤šæ— ç”¨ä»£ç åœ¨é¡¹ç›®ä¸­å¢åŠ ã€‚</br>
Assistantæä¾›çš„è¶…çº§ä¸šåŠ¡é“¾ï¼Œå¯ä»¥è®©ä½ è½»æ¾çš„ç¼–å†™ä¸šåŠ¡é“¾ï¼Œå¹¶è®©ä¸šåŠ¡é“¾çš„ç¼–å†™ï¼Œç†è§£ï¼Œç»´æŠ¤ï¼Œä¿®æ”¹å˜å¾—ç®€å•ï¼Œé«˜æ•ˆï¼Œæ— ä»£ç ä¾µå…¥æ€§ã€‚éšæ„æ‰©å±•ï¼Œçµæ´»ç»„è£…ã€‚
:::

## ä¸€ï¼Œå¿«é€Ÿä½¿ç”¨
æˆ‘ä»¬æ¥ä¸‹æ¥æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¶…çº§ä¸šåŠ¡é“¾ï¼Œæ¥å®Œæˆä¸€ä¸ªç®€å•çš„ä¸šåŠ¡æµç¨‹ã€‚</br>
è¿™ä¸ªä¸šåŠ¡æµç¨‹å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸”å­—ç¬¦ä¸²å¿…é¡»ä»¥assistantå¼€å¤´ï¼Œå¦‚æœä¸ç¬¦åˆåˆ™è¿”å›falseã€‚
### 1ï¼Œå¼•å…¥ä¾èµ–
::: warning æ³¨æ„ 
è¯·ç¡®ä¿é¡¹ç›®ä¸­å¼•å…¥äº†assistant-boot-starterä¾èµ–
:::

```xml
 <dependency>
    <groupId>io.github.geniusay</groupId>
    <artifactId>assistant-service</artifactId>
    <version>å°½é‡boot-starterç‰ˆæœ¬åŒæ­¥</version>
</dependency>
```

### 2ï¼Œç¼–å†™ä¸šåŠ¡é“¾
- ç»§æ‰¿AbstractFilterChainï¼Œå¹¶æ˜ç¡®éœ€è¦è¾“å…¥çš„ç±»å‹
- å°†æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•å†™å…¥filterä¸­
- æ·»åŠ @Chainæ³¨è§£ï¼Œå£°æ˜è¯¥ä¸šåŠ¡é“¾çš„åç§°

```java
@Chain("stringNotEmpty") //ä¸šåŠ¡é“¾åç§°
public class StringNotEmptyFilterChain extends AbstractFilterChain<String> {
    
    //ç¼–å†™ä¸šåŠ¡åŠŸèƒ½
    @Override
    public boolean filter(String value) {
        return !StringUtils.isEmpty(value);
    }

    @Override
    public List<ServicePoint> servicePoints() {
        return null;
    }
}

@Chain("startWithAssistant") //ä¸šåŠ¡é“¾åç§°
public class StringStartWithAssistantFilterChain extends AbstractFilterChain<String> {

    //ç¼–å†™ä¸šåŠ¡åŠŸèƒ½
    @Override
    public boolean filter(String value) {
        return value.startsWith("assistant");
    }

    @Override
    public List<ServicePoint> servicePoints() {
        return null;
    }
}
```

### 3ï¼Œæ„å»ºä¸šåŠ¡é“¾
åœ¨ä½ çš„yamlæ–‡ä»¶ä¸‹ï¼Œç»„è£…ä¸šåŠ¡é“¾ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
`ä¸šåŠ¡åç§°:ä¸šåŠ¡é“¾åç§°->ä¸šåŠ¡é“¾åç§°` ç®­å¤´ä¹‹é—´ä¸è¦æœ‰ç©ºæ ¼
```yaml
assistant:
  service-chain:
      serviceMap:
        string: stringNotEmpty->startWithAssistant
```

### 4ï¼Œä½¿ç”¨ä¸šåŠ¡é“¾
- å¼•å…¥ServiceChainFactoryç±»
- è°ƒç”¨getæ–¹æ³•ï¼Œæ ¹æ®ä¸šåŠ¡åç§°ï¼Œè·å–ä¸šåŠ¡é“¾å¼•å¯¼ç±»
- ä¼ å…¥éœ€è¦æ‰§è¡Œçš„ä¸šåŠ¡ç±»ï¼Œæ‰§è¡Œexecute()

```java
@Resource
private ServiceChainFactory factory;

@Test
public void testCommonChain(){
    String str = "assistant12345";
    boolean res = factory
        .get("string")  //æ ¹æ®ä¸šåŠ¡åç§°ï¼Œè·å–ä¸šåŠ¡é“¾å¼•å¯¼ç±»
        .execute(str);  //æ‰§è¡Œexecute()
}
```
> o(ï¿£â–½ï¿£)ï½„ æ€ä¹ˆæ ·è¿™å°±æ˜¯æ•´ä¸ªçš„ä¸šåŠ¡é“¾çš„ä½¿ç”¨ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ä¼˜é›…~ï¼Œä¸šåŠ¡é“¾çš„ç©æ³•è¿˜ä¸æ­¢äºæ­¤ï¼Œä½ è¿˜å¯ä»¥æ¥ç€å¾€ä¸‹çœ‹æ›´å¤šçš„åŠŸèƒ½ã€‚
## 

## äºŒï¼Œç»„è£…ä¸šåŠ¡æµç¨‹é“¾
> åœ¨assistantä¸­æœ‰å¤šç§ä¸šåŠ¡é“¾æ„å»ºçš„æ–¹å¼ï¼Œæ ¹è‡ªèº«éœ€è¦ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹æ³•æ¥æ„å»ºä½ çš„ä¸šåŠ¡é“¾ 

### 1ï¼Œyamlæ„å»ºä¸šåŠ¡æµç¨‹é“¾ï¼ˆæ¨èï¼‰
> æ„å»ºä¸šåŠ¡é“¾ä¸­æœ€æ¨èçš„ä¸€ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼å¯ä»¥æ›´åŠ ç›´è§‚çµæ´»ä¾¿æ·çš„æ„å»ºä½ çš„ä¸šåŠ¡é“¾ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œä¸šåŠ¡é“¾çš„è°ƒè¯•å’Œç»´æŠ¤ã€‚

æ ¼å¼å¦‚ä¸‹ï¼š
```yaml
assistant:
  service-chain:
      serviceMap:
        ä¸šåŠ¡åç§°: ä¸šåŠ¡é“¾åç§°->ä¸šåŠ¡é“¾åç§°
```

### 2ï¼Œä½¿ç”¨servicePointæ¥æ„å»ºä¸šåŠ¡æµç¨‹é“¾
> åœ¨ä¸šåŠ¡é“¾ç¼–å†™æ—¶ï¼Œå¯ä»¥é€šè¿‡é‡å†™servicePointsæ–¹æ³•æ¥é¢„å…ˆæŒ‡å®šè¯¥ä¸šåŠ¡é“¾åœ¨æŸä¸šåŠ¡ä¸­çš„ä½ç½®

ServicePointï¼š
- serviceNameï¼šä¸šåŠ¡åç§°
- orderï¼šä¸šåŠ¡åœ¨ä¸šåŠ¡é“¾ä¸­çš„é¡ºåºï¼Œorderå€¼è¶Šå°ï¼Œæ’åè¶Šå‰
- isIgnoreï¼šæ˜¯å¦å¿½è§†è¯¥ä¸šåŠ¡é“¾çš„ç»“æœï¼Œé»˜è®¤ä¸ºfalseï¼Œå³ä¸å¿½è§†

```java
@Chain("stringNotEmpty")
public class StringNotEmptyFilterChain extends AbstractFilterChain<String> {

    @Override
    public List<ServicePoint> servicePoints() {
        return List.of(
                new ServicePoint("hello",2),    //åœ¨helloä¸šåŠ¡ä¸­ï¼Œorderå€¼ä¸º2
                new ServicePoint("world",5)     //åœ¨worldä¸šåŠ¡ä¸­ï¼Œorderå€¼ä¸º5
        );
    }
}
```

### 3ï¼Œè‡ªå®šä¹‰æ„å»ºä¸šåŠ¡æµç¨‹é“¾
> åœ¨å¼€å‘ä¸­å¯ä»¥åŠ¨æ€çš„æ ¹æ®å·²æœ‰çš„ä¸šåŠ¡é“¾æ„å»ºæ–°çš„ä¸šåŠ¡é“¾ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€çš„æŒ‡å®šä¸šåŠ¡é“¾çš„é¡ºåº
å¯ä»¥é€šè¿‡new å¾—åˆ°ä¸šåŠ¡é“¾ï¼Œä¹Ÿå¯ä»¥é€šè¿‡factory.getChain("ä¸šåŠ¡é“¾åç§°")æ¥è·å–ä¸šåŠ¡é“¾ã€‚
```java
@Resource
private ServiceChainFactory factory;

@Test
public void testBuildChain(){
    ServiceChainBootstrap bootstrap = factory.bootstrap()
            .next(new ObjectNotEmptyFilterChain(), new StringNotEmptyFilterChain()) //æŒ‡å®šå¤šä¸ªä¸šåŠ¡é“¾ï¼ŒæŒ‰é¡ºåºæŒ‡å®š
            .next(factory.getChain("Exception"), true)                              //ä»å·¥å‚ä¸­æ ¹æ®ä¸šåŠ¡é“¾åç§°è·å–å·²æœ‰çš„ä¸šåŠ¡é“¾ï¼ŒæŒ‡å®šä¸šåŠ¡é“¾ï¼Œå¹¶æŒ‡å®šæ˜¯å¦å¿½è§†è¯¥ä¸šåŠ¡é“¾çš„ç»“æœ
            .next(factory.getChain("taskCheck");                                    
}
```
## ä¸‰ï¼Œä¸šåŠ¡é“¾å¼•å¯¼ç±»æ‰©å±•åŠŸèƒ½
å…³äºä¸šåŠ¡é“¾çš„åˆ›å»ºï¼Œä½¿ç”¨ï¼Œæ‰©å±•ï¼Œæ‰§è¡Œéƒ½æ˜¯ç”±`ä¸šåŠ¡é“¾å¼•å¯¼ç±» ServiceChainBootstrap`æ¥å¼•å¯¼å®Œæˆçš„ï¼Œç”¨æˆ·åªéœ€æ„å»ºè‡ªå·±çš„å¼•å¯¼ç±»å³å¯ä¸€æ¡é¾™çš„æ‰“é€ å±äºè‡ªå·±çš„ä¸šåŠ¡é“¾è„šæœ¬
### 1ï¼Œä¸šåŠ¡é“¾å‚æ•°é€‚é…å™¨
> ä¸€ä¸ªä¸šåŠ¡æµç¨‹ä¸­ä¼šæœ‰å¾ˆå¤šä¸šåŠ¡é“¾ï¼Œè€Œæ¯ä¸ªä¸šåŠ¡é“¾çš„å‚æ•°ç±»å‹å¯èƒ½ä¸åŒï¼Œå› æ­¤assistantæä¾›äº†ä¸šåŠ¡é“¾å‚æ•°é€‚é…å™¨ï¼Œç”¨äºå°†ä¼ å…¥å‚æ•°é€‚é…ä¸šåŠ¡é“¾çš„å‚æ•°ç±»å‹

ä¾‹å¦‚ï¼šStringNotEmptyä¸šåŠ¡é“¾ä¼ å…¥çš„æ˜¯Stringç±»å‹ï¼ŒTaskCheckä¸šåŠ¡é“¾ä¼ å…¥çš„æ˜¯Taskç±»å‹ï¼Œè¦æ ¡éªŒtaskNameä¸ä¸ºç©ºä¸”TaskChecké€šè¿‡ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š
- åœ¨`ä¸šåŠ¡é“¾å¼•å¯¼ç±»`ä¸­ï¼Œé…ç½®`supplierMap`ï¼Œåœ¨å‰é¢éœ€è¦å£°æ˜ä¼ å…¥çš„ç±»å‹æ˜¯ä»€ä¹ˆ
- æŒ‡å®škey,value
- keyä¸ºIntegerç±»å‹ï¼Œä»£è¡¨ç€è¦é€‚é…çš„ä¸šåŠ¡é“¾çš„ä½ç½®ï¼Œä»1å¼€å§‹
- valueä¸ºé€‚é…æ–¹æ³•ï¼Œä»£è¡¨ä½ è¦è¿”å›ä»€ä¹ˆå€¼ç»™è¯¥ä½ç½®ä¸šåŠ¡é“¾å»ä½¿ç”¨

```java
@Data
@AllArgsConstructor
public class TaskDO {
    private Integer taskId;

    private String taskName;

    private String taskDescription;
}

@Test
public void testSupplierChain(){
    TaskDO task = new TaskDO(12, "taskHello", "hello");
    //ä¸šåŠ¡taskçš„é“¾ç»“æ„ä¸º StringNotEmptyFilterChain -> TaskCheckFilterChain
    ServiceChainBootstrap bootstrap = factory
            .get("task")
            .<TaskDO>supplierMap(
                    Map.of(1, TaskDO::getTaskName)  //ä»£è¡¨ç¬¬ä¸€ä¸ªé“¾ä¼ å…¥çš„å‚æ•°ä¸º TaskDOçš„taskName
            );

    System.out.println(bootstrap.execute(task));
}
```
### 2ï¼Œä¸šåŠ¡é“¾Callbackæœºåˆ¶
> ä¸šåŠ¡é“¾çš„Callbackæœºåˆ¶ï¼Œç”¨äºåœ¨ä¸šåŠ¡é“¾æ‰§è¡Œå®Œæ¯•åï¼Œæ‰§è¡Œä¸€äº›å›è°ƒæ“ä½œ

å›è°ƒæ“ä½œåˆ†ä¸ºä¸¤ç§: `successCallback`å’Œ`failCallback`ï¼Œé¡¾åæ€ä¹‰ä¸ºæˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒ
- **successCallback**: ä¸šåŠ¡é“¾æ‰§è¡ŒæˆåŠŸåæ— å¼‚å¸¸ï¼Œæ‰§è¡Œçš„å›è°ƒæ“ä½œ
- **failCallback**: ä¸šåŠ¡é“¾æ‰§è¡Œå¤±è´¥æˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œå³ä½¿è¢«å¿½ç•¥ç»“æœä¹Ÿä¼šæ‰§è¡Œçš„å›è°ƒæ“ä½œ
ä»–çš„æ¥å…¥å’Œä½¿ç”¨æ–¹å¼ä¸ä¸šåŠ¡é“¾å‚æ•°é€‚é…å™¨ç±»ä¼¼ï¼Œ`ä¸šåŠ¡é“¾å¼•å¯¼ç±»`ä½¿ç”¨failCallbackMapä¸successCallbackMapæ¥è¿›è¡Œé…ç½®

```java
ServiceChainBootstrap bootstrap = factory
        .get("ignoreTaskException")
        .returnType(ReturnType.THROW)
        .<TaskDO>supplierMap(Map.of(1, TaskDO::getTaskName))
        .failCallbackMap(Map.of(                                    //æ„å»ºç¬¬ä¸€æ¡ä¸šåŠ¡é“¾æ‰§è¡Œå¤±è´¥åçš„å›è°ƒæ–¹æ³•
                1, () -> System.out.println("taskName is empty")
        ))
        .successCallbackMap(Map.of(                                 //æ„å»ºç¬¬ä¸€æ¡ä¸šåŠ¡é“¾æ‰§è¡ŒæˆåŠŸåçš„å›è°ƒæ–¹æ³• 
                1, () -> System.out.println("taskName not empty")
        ));
```
### 3ï¼Œä¸šåŠ¡é“¾è¿”å›æ¨¡å¼åˆ‡æ¢
> åœ¨ä¸šåŠ¡é“¾ä¸­æˆ‘æ²¡å¯ä»¥é€‰æ‹©å°†ä¸šåŠ¡é“¾ä¸­å‘ç”Ÿçš„å¼‚å¸¸ç»™æŠ›å‡ºæˆ–è€…è¿”å›ç»“æœå€¼ï¼Œèƒ½è¿›è¡Œä¸€ä¸ªè‡ªç”±çš„åˆ‡æ¢

ä½¿ç”¨`ä¸šåŠ¡é“¾å¼•å¯¼ç±»`çš„`returnType`æ–¹æ³•æ¥è¿›è¡Œé…ç½®ï¼Œç›®å‰æ”¯æŒä»¥ä¸‹ä¸¤ç§æ¨¡å¼:
- **ReturnType.THROW**: ä¸šåŠ¡é“¾ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸
- **ReturnType.BOOLEAN**ï¼ˆé»˜è®¤ï¼‰: ä¸šåŠ¡é“¾ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè¿”å›ç»“æœå€¼

```java
ServiceChainBootstrap bootstrap = factory
                .get("taskException")
                .returnType(ReturnType.THROW)   //è¿”å›æ¨¡å¼ä¸ºæŠ›å‡ºå¼‚å¸¸
                .<TaskDO>supplierMap(Map.of(1, TaskDO::getTaskName));
```

### 4ï¼Œä¸šåŠ¡é“¾å¿½ç•¥æ¨¡å¼
> å¯¹äºä¸€ä¸ªä¸šåŠ¡é“¾ä»–çš„ç»“æœä¸å¦ï¼Œæ˜¯å¦å¼‚å¸¸ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚å¿½ç•¥æ‰ä¸šåŠ¡é“¾çš„ç»“æœæ¥ç€å¾€ä¸‹æ‰§è¡Œ

å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹æ³•æ¥è®¾ç½®æŸæ¡ä¸šåŠ¡é“¾æ˜¯å¦è¢«å¿½ç•¥
- **yamlï¼š** åœ¨ä¸šåŠ¡é“¾é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹å¯¹åº”çš„ä¸šåŠ¡é“¾åç§°ååŠ ä¸Š`[ignore]`æ ‡ç­¾(å¤§å°å†™éƒ½ğŸ†—)</br>
`ignoreTaskException: stringNotEmpty->objectNotEmpty->taskCheck->Exception[ignore]`
- **servicePointï¼š** è®¾ç½®servicePointçš„ignoreå±æ€§ä¸ºtrue</br>
`new ServicePoint("hello",5,true)`
- **ServiceChainBootstrapï¼š** ä½¿ç”¨nextæ–¹æ³•æ—¶ï¼Œå°†ignoreå±æ€§è®¾ç½®ä¸ºtrue</br>
`next(factory.getChain("Exception"), true)`
